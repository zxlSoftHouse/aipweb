webpackJsonp([29],{Sx8M:function(e,t,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=l("woOf"),o=l.n(a),i=l("vLgD"),n=function(e,t,l){return Object(i.a)({url:"api/SERVICE-AIP/deviceModel/queryPage",method:"post",data:{pageNum:e,pageSize:t,deviceType:l.deviceType}})},r=function(e){return Object(i.a)({url:"api/SERVICE-AIP/deviceModel/deleteDeviceModel/"+e,method:"post",data:{}})},c=function(e){return Object(i.a)({url:"api/SERVICE-AIP/deviceModel/insertLampControl",method:"post",data:e})},s=function(e){return Object(i.a)({url:"api/SERVICE-AIP/deviceModel/queryDeviceModel",method:"get",params:{deviceModelId:e}})},d=function(e){return Object(i.a)({url:"api/SERVICE-AIP/deviceModel/updateDeviceModel",method:"post",data:e})},p=function(e){return Object(i.a)({url:"api/SERVICE-AIP/deviceModel/checkDeviceBinding",method:"post",data:e})},u=l("0xDb"),m={rowId:"",modelCode:"",modelName:"",modelDate:"",lampControlParamList:[],deviceType:"",lampControlPowersrc:"1",protocalPath:""},v={data:function(){return{flag:"",total:0,pageSize:10,currentPage:1,tableData:[],multipleSelection:[],showDialog:!1,dialogTitle:"",searchInfo:{deviceType:""},deviceModel:{},formSelection:{htmlOption:[{value:"1",label:"输入框"},{value:"2",label:"下拉框"},{value:"3",label:"多选"},{value:"4",label:"文本框"},{value:"5",label:"单选"}],dataTypeOption:[{value:"1",label:"整数"},{value:"2",label:"文字"}],deviceTypeOptions:[{value:"00",label:"灯杆"},{value:"01",label:"灯"},{value:"02",label:"单灯控制器"},{value:"03",label:"集中控制器"},{value:"04",label:"LED屏"},{value:"05",label:"传感器"},{value:"06",label:"一键报警"}],lampControlTypeOptions:[{value:"1",label:"基站通讯"},{value:"0",label:"集控器通讯"}],PowersrcOptions:[{label:"市电",value:"0"},{label:"太阳能",value:"1"}]},rules:{},formLabelWidth:"100px"}},components:{},mounted:function(){this.deviceModel=m,this.getTableData()},methods:{getTableData:function(){var e=this;n(this.currentPage,this.pageSize,this.searchInfo).then(function(t){e.total=t.total,e.tableData=t.records})},modelDateFormat:function(e){return Object(u.parseTime)(e.modelDate,"{y}-{m}-{d}")},selectDeviceType:function(){this.getTableData()},handleAdd:function(){this.deviceModel=m,this.flag="add",this.dialogTitle="新增",this.showDialog=!0},handleEdit:function(){var e=this;if(this.flag="edit",0!=this.multipleSelection.length)if(1===this.multipleSelection.length){var t=this.multipleSelection[0];p(t).then(function(l){l?e.$message({type:"warning",message:"该设备已有绑定数据，不允许修改！"}):(s(t.rowId).then(function(t){e.deviceModel=o()(e.deviceModel,t)}),e.dialogTitle="编辑",e.showDialog=!0)})}else this.$message({type:"warning",message:"不支持多条编辑"});else this.$message({type:"warning",message:"请先选择一条记录"})},handleDelete:function(){var e=this;0!=this.multipleSelection.length?1==this.multipleSelection.length?this.$confirm("确定要删除此条记录?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var t=e.multipleSelection[0];p(t).then(function(l){l?e.$message({type:"warning",message:"该设备已有绑定数据，不允许删除！"}):e.doDelete(t.rowId)})}).catch(function(){e.$message({type:"info",message:"已取消删除"})}):this.$message({type:"warning",message:"不支持批量删除"}):this.$message({type:"warning",message:"请先选择一条记录"})},doDelete:function(e){var t=this;r(e).then(function(){t.$message({type:"success",message:"删除成功"}),t.getTableData()}).catch(function(){t.$message.error("服务器错误")})},saveOrUpdate:function(){var e=this;"add"==this.flag?c(this.deviceModel).then(function(t){t>0?(e.showDialog=!1,e.$message({type:"success",message:"新增成功"}),e.getTableData()):e.$message.error("服务器错误")}):d(this.deviceModel).then(function(t){t>0?(e.showDialog=!1,e.$message({type:"success",message:"修改成功"}),e.getTableData()):e.$message.error("服务器错误")})},cancelUpdate:function(){this.showDialog=!1,this.deviceModel.lampControlParamList=[],this.$refs.Form.resetFields()},handleSelectionChange:function(e){this.multipleSelection=e},current_change:function(e){this.currentPage=e,this.getTableData()},addOneParm:function(){this.deviceModel.lampControlParamList.push({param:"",htmlType:"",dataType:"",option:""})},deleteOneParm:function(){this.deviceModel.lampControlParamList.pop()}}},h={render:function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",[l("el-row",[l("el-col",{attrs:{span:16}},[l("el-button",{attrs:{type:"success"},on:{click:function(t){return e.handleAdd()}}},[e._v("新增")]),e._v(" "),l("el-button",{on:{click:function(t){return e.handleEdit()}}},[e._v("编辑")]),e._v(" "),l("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.handleDelete()}}},[e._v("删除")]),e._v("\r\n          设备类型\r\n        "),l("el-select",{attrs:{placeholder:"请选择设备类型"},on:{change:e.selectDeviceType},model:{value:e.searchInfo.deviceType,callback:function(t){e.$set(e.searchInfo,"deviceType",t)},expression:"searchInfo.deviceType"}},[l("el-option",{attrs:{label:"全部",value:""}}),e._v(" "),e._l(e.formSelection.deviceTypeOptions,function(e){return l("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})],2)],1)],1),e._v(" "),l("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,"tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange}},[l("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),l("el-table-column",{attrs:{prop:"modelCode",label:"型号编号"}}),e._v(" "),l("el-table-column",{attrs:{prop:"modelName",label:"型号名称"}}),e._v(" "),l("el-table-column",{attrs:{prop:"modelDate",label:"出厂时间",formatter:e.modelDateFormat}})],1),e._v(" "),l("div",{staticStyle:{"text-align":"center","margin-top":"30px"}},[l("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:e.total},on:{"current-change":e.current_change}})],1),e._v(" "),l("el-dialog",{staticClass:"dialog-common-sys",attrs:{width:"70%",title:e.dialogTitle,visible:e.showDialog,"modal-append-to-body":!1,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showDialog=t},close:function(t){return e.cancelUpdate()}}},[l("el-form",{ref:"Form",attrs:{model:e.deviceModel,rules:e.rules}},[l("el-row",[l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"型号编号","label-width":e.formLabelWidth,prop:"modelCode"}},[l("el-input",{attrs:{"auto-complete":"off",placeholder:"请填写型号编号"},model:{value:e.deviceModel.modelCode,callback:function(t){e.$set(e.deviceModel,"modelCode",t)},expression:"deviceModel.modelCode"}})],1)],1),e._v(" "),l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"型号名称","label-width":e.formLabelWidth,prop:"modelName"}},[l("el-input",{attrs:{"auto-complete":"off",placeholder:"请填写型号名称"},model:{value:e.deviceModel.modelName,callback:function(t){e.$set(e.deviceModel,"modelName",t)},expression:"deviceModel.modelName"}})],1)],1),e._v(" "),l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"出厂时间","label-width":e.formLabelWidth,prop:"modelDate"}},[l("el-date-picker",{attrs:{type:"date",placeholder:"选择出厂时间"},model:{value:e.deviceModel.modelDate,callback:function(t){e.$set(e.deviceModel,"modelDate",t)},expression:"deviceModel.modelDate"}})],1)],1),e._v(" "),l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"设备类型","label-width":e.formLabelWidth,prop:"deviceType"}},[l("el-select",{attrs:{placeholder:"请选择设备类型"},model:{value:e.deviceModel.deviceType,callback:function(t){e.$set(e.deviceModel,"deviceType",t)},expression:"deviceModel.deviceType"}},e._l(e.formSelection.deviceTypeOptions,function(e){return l("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1),e._v(" "),"02"==this.deviceModel.deviceType?l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"通讯方式","label-width":e.formLabelWidth,prop:"lampControlType"}},[l("el-select",{attrs:{placeholder:"请选择通讯方式"},model:{value:e.deviceModel.lampControlType,callback:function(t){e.$set(e.deviceModel,"lampControlType",t)},expression:"deviceModel.lampControlType"}},e._l(e.formSelection.lampControlTypeOptions,function(e){return l("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1):e._e(),e._v(" "),"02"==this.deviceModel.deviceType?l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"能源类型","label-width":e.formLabelWidth,prop:"lampControlPowersrc"}},[l("el-select",{attrs:{placeholder:"请选择能源类型"},model:{value:e.deviceModel.lampControlPowersrc,callback:function(t){e.$set(e.deviceModel,"lampControlPowersrc",t)},expression:"deviceModel.lampControlPowersrc"}},e._l(e.formSelection.PowersrcOptions,function(e){return l("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1):e._e(),e._v(" "),"02"==this.deviceModel.deviceType||"03"==this.deviceModel.deviceType?l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"协议解析地址","label-width":e.formLabelWidth,prop:"protocalPath"}},[l("el-input",{attrs:{"auto-complete":"off",placeholder:"请填写协议解析地址"},model:{value:e.deviceModel.protocalPath,callback:function(t){e.$set(e.deviceModel,"protocalPath",t)},expression:"deviceModel.protocalPath"}})],1)],1):e._e()],1),e._v(" "),"02"==this.deviceModel.deviceType?l("div",[l("el-row",[e._v("\r\n              参数项配置\r\n              "),l("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(t){return e.addOneParm()}}},[e._v("增加")]),e._v(" "),l("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.deleteOneParm()}}},[e._v("删除")])],1),e._v(" "),e._l(e.deviceModel.lampControlParamList,function(t,a){return l("el-row",{key:a},[l("el-col",{attrs:{span:6}},[l("el-form-item",{attrs:{label:"参数项名称","label-width":e.formLabelWidth,prop:"param"}},[l("el-input",{attrs:{"auto-complete":"off",placeholder:"请填写参数项名称"},model:{value:t.param,callback:function(l){e.$set(t,"param",l)},expression:"item.param"}})],1)],1),e._v(" "),l("el-col",{attrs:{span:6}},[l("el-form-item",{attrs:{label:"Html类型","label-width":e.formLabelWidth,prop:"htmlType"}},[l("el-select",{attrs:{placeholder:"请选择Html类型"},model:{value:t.htmlType,callback:function(l){e.$set(t,"htmlType",l)},expression:"item.htmlType"}},e._l(e.formSelection.htmlOption,function(e){return l("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1),e._v(" "),l("el-col",{attrs:{span:6}},[l("el-form-item",{attrs:{label:"数据类型","label-width":e.formLabelWidth,prop:"dataType"}},[l("el-select",{attrs:{placeholder:"请选择数据类型"},model:{value:t.dataType,callback:function(l){e.$set(t,"dataType",l)},expression:"item.dataType"}},e._l(e.formSelection.dataTypeOption,function(e){return l("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1),e._v(" "),l("el-col",{attrs:{span:6}},[l("el-form-item",{attrs:{label:"选项","label-width":e.formLabelWidth,prop:"option"}},[l("el-input",{attrs:{"auto-complete":"off",placeholder:"请填写选项"},model:{value:t.option,callback:function(l){e.$set(t,"option",l)},expression:"item.option"}})],1)],1)],1)})],2):e._e()],1),e._v(" "),l("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[l("el-button",{on:{click:function(t){return e.cancelUpdate()}}},[e._v("取 消")]),e._v(" "),l("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.saveOrUpdate()}}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]},f=l("VU/8")(v,h,!1,null,null,null);t.default=f.exports}});