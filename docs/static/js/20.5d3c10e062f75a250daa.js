webpackJsonp([20],{"3cnC":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("614m"),l=a("0xDb"),i={data:function(){return{flag:"",total:0,pageSize:10,currentPage:1,tableData:[],ledTableData:[],multipleSelection:[],showDialog:!1,selectedTaskId:"",ledFilter:{total:0,pageSize:5,currentPage:1},buttonDisabled:!1,loading:!1}},mounted:function(){this.getTableData()},methods:{getTableData:function(){var t=this;n.a.getList(this.currentPage,this.pageSize).then(function(e){t.total=e.total,t.tableData=e.records})},getLedTableData:function(){var t=this;n.a.getLedList(this.ledFilter).then(function(e){t.ledFilter.total=e.total,t.ledTableData=e.records})},timeFmt:function(t){return Object(l.parseTime)(t.createTime,"{y}-{m}-{d}")},handleAdd:function(){this.$router.push({name:"addOrEditTask",params:{flag:"add"}})},handleEdit:function(t){var e=this;this.flag="edit",n.a.getLEDItem(t).then(function(t){e.$router.push({name:"addOrEditTask",params:{item:t,flag:"edit"}})})},doDelete:function(t){var e=this;this.$confirm("确定要删除此条记录?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){n.a.doDelete(t).then(function(t){e.$message({type:t.result?"success":"error",message:t.result?"删除成功":t.errorMsg}),e.getTableData()})}).catch(function(){e.$message({type:"info",message:"已取消删除"})})},chooseLED:function(t){this.showDialog=!0,this.selectedTaskId=t,this.getLedTableData()},sendTask:function(){var t=this;0!=this.multipleSelection.length?n.a.getTaskDetail(this.selectedTaskId).then(function(e){t.loading=!0,t.buttonDisabled=!0;t.multipleSelection.map(function(a){n.a.sendTask(a.ipAddress,t.GLOBAL.downloadUri,t.GLOBAL.downloadProgressUri,e).then(function(t){})}),t.$message({type:"success",message:"发送成功"}),t.buttonDisabled=!1,t.showDialog=!1,t.loading=!1}):this.$message({type:"warning",message:"请先选择LED屏"})},current_change:function(t){this.currentPage=t,this.getTableData()},current_change_led:function(t){this.currentPage=t,this.getLedTableData()},handleSelectionChange:function(t){this.multipleSelection=t},cancel:function(){this.multipleSelection=[],this.showDialog=!1}}},o={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-row",[a("el-col",[a("el-button",{attrs:{type:"success"},on:{click:function(e){return t.handleAdd()}}},[t._v("新增")])],1)],1),t._v(" "),a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.tableData,"tooltip-effect":"dark"}},[a("el-table-column",{attrs:{prop:"taskName",label:"任务名称"}}),t._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"创建时间",formatter:t.timeFmt}}),t._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"编辑任务",placement:"top"}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-edit",circle:""},on:{click:function(a){return t.handleEdit(e.row.rowId)}}})],1),t._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"删除任务",placement:"top"}},[a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(a){return t.doDelete(e.row.rowId)}}})],1),t._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"发送任务",placement:"top"}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-upload2",circle:""},on:{click:function(a){return t.chooseLED(e.row.rowId)}}})],1)]}}])})],1),t._v(" "),a("div",{staticStyle:{"text-align":"center","margin-top":"30px"}},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:t.total},on:{"current-change":t.current_change}})],1),t._v(" "),a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"dialog-common-sys",attrs:{title:"选择LED屏",visible:t.showDialog,"modal-append-to-body":!1,"close-on-click-modal":!1},on:{"update:visible":function(e){t.showDialog=e},close:function(e){return t.cancel()}}},[a("el-row",[a("el-col")],1),t._v(" "),a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.ledTableData,"tooltip-effect":"dark"},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),t._v(" "),a("el-table-column",{attrs:{prop:"ledName",label:"LED屏名称"}})],1),t._v(" "),a("div",{staticStyle:{"text-align":"center","margin-top":"30px"}},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:t.ledFilter.total,"page-size":t.ledFilter.pageSize},on:{"current-change":t.current_change_led}})],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{disabled:t.buttonDisabled},on:{click:function(e){return t.cancel()}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary",disabled:t.buttonDisabled},on:{click:function(e){return t.sendTask()}}},[t._v("确 定")])],1)],1)],1)},staticRenderFns:[]},r=a("VU/8")(i,o,!1,null,null,null);e.default=r.exports}});