webpackJsonp([31],{hIpC:function(e,t,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=l("woOf"),o=l.n(r),a=l("vLgD"),n=function(e,t){return Object(a.a)({url:"api/SERVICE-AIP/centralizedControl/getCentralizedConPage",method:"post",data:{pageNum:e,pageSize:t}})},i=function(e){return Object(a.a)({url:"api/SERVICE-AIP/centralizedControl/deleteByIdList",method:"post",data:e})},s=function(e){return Object(a.a)({url:"api/SERVICE-AIP/centralizedControl/update",method:"put",data:e})},c=function(e){return Object(a.a)({url:"api/SERVICE-AIP/centralizedControl/queryById/"+e,method:"get"})},u=function(e){return Object(a.a)({url:"api/SERVICE-AIP/deviceModel/queryList",method:"post",data:{deviceType:e}})},d=function(){return Object(a.a)({url:"api/SERVICE-AIP/deviceTender/queryList",method:"post",data:{}})},p={components:{bmap:l("j67P").a},data:function(){return{mapInfo:{center:{lng:"",lat:""},markerPoint:{lng:"",lat:""},markerList:[]},flag:"",total:100,pageSize:10,currentPage:1,tableData:[],multipleSelection:[],showDialog:!1,dialogTitle:"",formLabelWidth:"100px",centerController:{rowId:"",address:"",tender:"",type:"",protocolXml:"",name:"",registration:"",loopNum:"",boxCode:"",encryption:"",variableratio:"",alarm:"",coilNum:"",longitude:"",latitude:""},formSelection:{tenderOption:[],loopNumOption:[{value:"4",label:"4"},{value:"8",label:"8"},{value:"16",label:"16"}],YONOption:[{value:"1",label:"是"},{value:"0",label:"否"}],centerControllerTypeOption:[]},rules:{encryption:[{required:!0,message:"请选择是否加密",trigger:"change"}],alarm:[{required:!0,message:"请选择是否报警",trigger:"change"}],coilNum:[{required:!0,message:"请填写线圈数量",trigger:"blur"}],loopTime:[{required:!0,message:"请填写轮询时间",trigger:"blur"}],boxCode:[{required:!0,message:"请填写控制箱编号",trigger:"blur"}],variableratio:[{required:!0,message:"请填写变比",trigger:"blur"}],loopNum:[{required:!0,message:"请选择回路数量",trigger:"change"}],address:[{required:!0,message:"请填写集控器地址",trigger:"blur"}],registration:[{required:!0,message:"请填写TCP注册包",trigger:"blur"}],tender:[{required:!0,message:"请选择集控器厂家",trigger:"change"}],name:[{required:!0,message:"请填写集控器名称",trigger:"blur"}]},drawnFeatures:[]}},watch:{drawnFeatures:{handler:function(e,t){1!==e.length&&(this.drawnFeatures=[e[1]])},deep:!0}},mounted:function(){this.getTableData(),this.getOptions()},methods:{formatOnLine:function(e,t){return"0"===e.onlinestate?"在线":"离线"},getTableData:function(){var e=this;n(this.currentPage,this.pageSize).then(function(t){e.total=t.total,e.tableData=t.records})},getOptions:function(){var e=this;u("03").then(function(t){e.formSelection.centerControllerTypeOption=t}),d().then(function(t){e.formSelection.tenderOption=t.filter(function(e){return"03"===e.deviceType})})},getPosition:function(e){this.centerController.longitude=e.lng,this.centerController.latitude=e.lat},handleAdd:function(){this.centerController.rowId="",this.flag="add",this.dialogTitle="新增",this.showDialog=!0},handleEdit:function(){var e=this;if(this.flag="edit",0!=this.multipleSelection.length)if(1===this.multipleSelection.length){var t=this.multipleSelection[0];c(t.rowId).then(function(t){e.centerController=o()(e.centerController,t),e.mapInfo.center.lng=t.longitude,e.mapInfo.center.lat=t.latitude,e.mapInfo.markerPoint=e.mapInfo.center,e.mapInfo.markerList=e.tableData.map(function(e){return new BMap.Point(e.longitude,e.latitude)})}),this.dialogTitle="编辑",this.showDialog=!0}else this.$message({type:"warning",message:"不支持多条编辑"});else this.$message({type:"warning",message:"请先选择一条记录"})},handleDelete:function(){var e=this;0!=this.multipleSelection.length?this.$confirm("确定要删除此条记录?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var t=[];e.multipleSelection.map(function(e){t.push(e.rowId)}),e.doDelete(t)}).catch(function(){e.$message({type:"info",message:"已取消删除"})}):this.$message({type:"warning",message:"请先选择一条记录"})},doDelete:function(e){var t=this;i(e).then(function(e){e?(t.$message({type:"success",message:"删除成功"}),t.getTableData()):t.$message.error("服务器错误")})},cancelUpdate:function(){this.$refs.Form.resetFields(),this.showDialog=!1},saveOrUpdate:function(){var e=this;this.$refs.Form.validate(function(t){t&&s(e.centerController).then(function(t){t.rowId?(e.showDialog=!1,e.$message({type:"success",message:"add"==e.flag?"新增成功":"修改成功"}),e.getTableData()):e.$message.error("服务器错误")})})},current_change:function(e){this.currentPage=e,this.getTableData()},handleSelectionChange:function(e){this.multipleSelection=e}}},m={render:function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",[l("el-row",[l("el-col",{attrs:{span:16}},[l("el-button",{attrs:{type:"success"},on:{click:function(t){return e.handleAdd()}}},[e._v("新增")]),e._v(" "),l("el-button",{on:{click:function(t){return e.handleEdit()}}},[e._v("编辑")]),e._v(" "),l("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.handleDelete()}}},[e._v("删除")])],1)],1),e._v(" "),l("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,"tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange}},[l("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),l("el-table-column",{attrs:{prop:"name",label:"集控器名称"}}),e._v(" "),l("el-table-column",{attrs:{prop:"tenderName",label:"集控器厂家"}}),e._v(" "),l("el-table-column",{attrs:{prop:"typeName",label:"集控器类型"}}),e._v(" "),l("el-table-column",{attrs:{prop:"address",label:"集控器地址"}}),e._v(" "),l("el-table-column",{attrs:{prop:"loopNum",label:"回路数量"}}),e._v(" "),l("el-table-column",{attrs:{prop:"registration",label:"TCP注册包"}}),e._v(" "),l("el-table-column",{attrs:{prop:"coilNum",label:"线圈数量"}})],1),e._v(" "),l("div",{staticStyle:{"text-align":"center","margin-top":"30px"}},[l("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:e.total},on:{"current-change":e.current_change}})],1),e._v(" "),l("el-dialog",{staticClass:"dialog-common-sys",attrs:{title:e.dialogTitle,visible:e.showDialog,"modal-append-to-body":!1,"close-on-click-modal":!1,width:"80%"},on:{"update:visible":function(t){e.showDialog=t},close:function(t){return e.cancelUpdate()}}},[l("el-form",{ref:"Form",attrs:{model:e.centerController,rules:e.rules,inline:!0}},[l("el-row",[l("el-col",{attrs:{span:12}},[l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"集控器名称","label-width":e.formLabelWidth,prop:"name"}},[l("el-input",{attrs:{"auto-complete":"off",placeholder:"请填写集控器名称"},model:{value:e.centerController.name,callback:function(t){e.$set(e.centerController,"name",t)},expression:"centerController.name"}})],1)],1),e._v(" "),l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"集控器厂家","label-width":e.formLabelWidth,prop:"tender"}},[l("el-select",{attrs:{placeholder:"请选择集控器厂家"},model:{value:e.centerController.tender,callback:function(t){e.$set(e.centerController,"tender",t)},expression:"centerController.tender"}},e._l(e.formSelection.tenderOption,function(e){return l("el-option",{key:e.rowId,attrs:{label:e.venderName,value:e.rowId}})}),1)],1)],1),e._v(" "),l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"TCP注册包","label-width":e.formLabelWidth,prop:"registration"}},[l("el-input",{attrs:{"auto-complete":"off",placeholder:"请填写TCP注册包"},model:{value:e.centerController.registration,callback:function(t){e.$set(e.centerController,"registration",t)},expression:"centerController.registration"}})],1)],1),e._v(" "),l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"集控器型号","label-width":e.formLabelWidth,prop:"protocolXml"}},[l("el-select",{attrs:{placeholder:"请选择集控器型号"},model:{value:e.centerController.type,callback:function(t){e.$set(e.centerController,"type",t)},expression:"centerController.type"}},e._l(e.formSelection.centerControllerTypeOption,function(e){return l("el-option",{key:e.rowId,attrs:{label:e.modelName,value:e.rowId}})}),1)],1)],1),e._v(" "),l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"集控器地址","label-width":e.formLabelWidth,prop:"address"}},[l("el-input",{attrs:{"auto-complete":"off",placeholder:"请填写集控器地址"},model:{value:e.centerController.address,callback:function(t){e.$set(e.centerController,"address",t)},expression:"centerController.address"}})],1)],1),e._v(" "),l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"回路数量","label-width":e.formLabelWidth,prop:"loopNum"}},[l("el-select",{attrs:{placeholder:"请选择回路数量"},model:{value:e.centerController.loopNum,callback:function(t){e.$set(e.centerController,"loopNum",t)},expression:"centerController.loopNum"}},e._l(e.formSelection.loopNumOption,function(e){return l("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1),e._v(" "),l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"集控器变比","label-width":e.formLabelWidth,prop:"variableratio"}},[l("el-input",{attrs:{"auto-complete":"off",placeholder:"请填写变比"},model:{value:e.centerController.variableratio,callback:function(t){e.$set(e.centerController,"variableratio",t)},expression:"centerController.variableratio"}})],1)],1),e._v(" "),l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"控制箱编号","label-width":e.formLabelWidth,prop:"boxCode"}},[l("el-input",{attrs:{"auto-complete":"off",placeholder:"请填写控制箱编号"},model:{value:e.centerController.boxCode,callback:function(t){e.$set(e.centerController,"boxCode",t)},expression:"centerController.boxCode"}})],1)],1),e._v(" "),l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"线圈数量","label-width":e.formLabelWidth,prop:"coilNum"}},[l("el-input",{attrs:{"auto-complete":"off",placeholder:"请填写线圈数量"},model:{value:e.centerController.coilNum,callback:function(t){e.$set(e.centerController,"coilNum",t)},expression:"centerController.coilNum"}})],1)],1),e._v(" "),l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"是否报警","label-width":e.formLabelWidth,prop:"alarm"}},[l("el-select",{attrs:{placeholder:"请选择是否报警"},model:{value:e.centerController.alarm,callback:function(t){e.$set(e.centerController,"alarm",t)},expression:"centerController.alarm"}},e._l(e.formSelection.YONOption,function(e){return l("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1),e._v(" "),l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"是否加密","label-width":e.formLabelWidth,prop:"encryption"}},[l("el-select",{attrs:{placeholder:"请选择是否加密"},model:{value:e.centerController.encryption,callback:function(t){e.$set(e.centerController,"encryption",t)},expression:"centerController.encryption"}},e._l(e.formSelection.YONOption,function(e){return l("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1),e._v(" "),l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"经度","label-width":e.formLabelWidth,prop:"longitude"}},[l("el-input",{attrs:{"auto-complete":"off",placeholder:"请点击地图选择",disabled:!0},model:{value:e.centerController.longitude,callback:function(t){e.$set(e.centerController,"longitude",t)},expression:"centerController.longitude"}})],1)],1),e._v(" "),l("el-col",{attrs:{span:12}},[l("el-form-item",{attrs:{label:"纬度","label-width":e.formLabelWidth,prop:"latitude"}},[l("el-input",{attrs:{"auto-complete":"off",placeholder:"请点击地图选择",disabled:!0},model:{value:e.centerController.latitude,callback:function(t){e.$set(e.centerController,"latitude",t)},expression:"centerController.latitude"}})],1)],1)],1),e._v(" "),l("el-col",{attrs:{span:12}},[l("div",[l("bmap",{attrs:{setMarker:!0,mapInfo:e.mapInfo},on:{changeMarker:e.getPosition}})],1)])],1)],1),e._v(" "),l("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[l("el-button",{on:{click:function(t){return e.cancelUpdate()}}},[e._v("取 消")]),e._v(" "),l("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.saveOrUpdate()}}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]},f=l("VU/8")(p,m,!1,null,null,null);t.default=f.exports}});