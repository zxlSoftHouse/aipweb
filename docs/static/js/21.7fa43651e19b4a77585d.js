webpackJsonp([21],{LW8P:function(e,t,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=l("Gu7T"),i=l.n(a),s=l("gBtx"),o=l.n(s),n=l("614m"),c={data:function(){return{flag:"",task:{taskName:"",ledTaskDetailList:[]},itemList:[],programList:[],total:0,pageSize:5,currentPage:1,showScheduleDialog:!1,showProgramDialog:!1,multipleSelection:[],selectIndex:0,selectScheduleIndex:0,date:[],time:[new Date(2016,9,10,8,40),new Date(2016,9,10,9,40)],scheduleList:[],schedule:{dateType:"All",startDate:"",endDate:"",timeType:"All",startTime:"",endTime:"",filterType:"None",weekFilter:[]}}},created:function(){this.flag=this.$route.params.flag},mounted:function(){"edit"===this.flag&&this.initData()},methods:{initData:function(){var e=this.$route.params.item;this.task.rowId=e.rowId,this.task.taskName=e.taskName,this.itemList=e.ledTaskDetailList,this.itemList.map(function(e){e.detailScheduleList.map(function(e){e.weekFilter=null===e.weekFilter?[]:e.weekFilter.split(",")})})},dateRangeFmt:function(e){return"All"===e.dateType?"永久":e.startDate+"~"+e.endDate},timeRangeFmt:function(e){return"All"===e.timeType?"永久":e.startTime+"~"+e.endTime},weekFilterFmt:function(e){if("None"===e.filterType)return"无指定星期";var t="";return e.weekFilter.map(function(e){var l=["周一,","周二,","周三,","周四,","周五,","周六,","周日,"][o()(e)-1];t=t.concat(l)}),t.substr(0,t.length-1)},openProgramList:function(){var e=this;n.a.getProgramList(this.currentPage,this.pageSize).then(function(t){e.showProgramDialog=!0,e.programList=t.records,e.total=t.total})},back:function(){this.$router.push({name:"taskManager"})},scheduleManager:function(e){this.selectIndex=e,this.showScheduleDialog=!0,this.scheduleList=this.itemList[e].detailScheduleList},cancelUpdate:function(){this.showScheduleDialog=!1},saveOrUpdateSchedule:function(){this.itemList[this.selectIndex].detailScheduleList=this.scheduleList,this.scheduleList=[],this.showScheduleDialog=!1},addPrograms:function(){var e;this.multipleSelection.map(function(e){e.detailScheduleList=[],e.repeatTimes="1",e.ledItemId=e.rowId}),(e=this.itemList).push.apply(e,i()(this.multipleSelection)),this.showProgramDialog=!1,this.multipleSelection=[]},moveItem:function(e){e!==this.itemList.length-1?this.itemList[e]=this.itemList.splice(e+1,1,this.itemList[e])[0]:this.$message({type:"error",message:"到底啦！"})},removeItem:function(e){this.itemList.splice(e,1)},handleSelectionChange:function(e){this.multipleSelection=e},current_change:function(e){this.currentPage=e,this.openProgramList()},selectDate:function(){this.schedule.startDate=this.date[0],this.schedule.endDate=this.date[1]},selectTime:function(){},addOneSchedule:function(){this.scheduleList.push(this.schedule),this.resetSchedule()},removeOneSchedule:function(e){this.scheduleList.splice(e-1,1)},resetSchedule:function(){this.schedule={dateType:"All",startDate:"",endDate:"",timeType:"All",startTime:"",endTime:"",filterType:"None",weekFilter:[]},this.date=[],this.time=[]},saveOrUpdateTask:function(){var e=this;this.itemList.map(function(t,l){var a={};a.detailScheduleList=t.detailScheduleList,a.detailScheduleList.map(function(e){e.weekFilter=e.weekFilter.join(",")}),a.ledItemId=t.ledItemId,a.repeatTimes=t.repeatTimes,a.sortNo=l,e.task.ledTaskDetailList.push(a)}),n.a.addOrEdit(this.task).then(function(t){t.result?(e.$message({type:"success",message:"add"===e.flag?"新增成功！":"修改成功！"}),e.back()):e.$message.error(t.errorMsg)})}}},r={render:function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",[l("el-row",{attrs:{type:"flex",align:"middle"}},[l("div",{staticStyle:{"padding-right":"30px"}},[e._v("任务名: ")]),e._v(" "),l("el-col",{attrs:{span:4}},[l("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.task.taskName,callback:function(t){e.$set(e.task,"taskName",t)},expression:"task.taskName"}})],1),e._v(" "),l("el-col",{attrs:{span:8}},[l("el-button",{attrs:{type:"success"},on:{click:function(t){return e.openProgramList()}}},[e._v("添加节目")]),e._v(" "),l("el-button",{attrs:{icon:"el-icon-upload"},on:{click:function(t){return e.saveOrUpdateTask()}}},[e._v("保存")]),e._v(" "),l("el-button",{attrs:{icon:"el-icon-caret-left"},on:{click:function(t){return e.back()}}},[e._v("返回")])],1)],1),e._v(" "),l("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.itemList,"tooltip-effect":"dark"}},[l("el-table-column",{attrs:{prop:"itemName",label:"节目名"}}),e._v(" "),l("el-table-column",{attrs:{prop:"fileSize",label:"大小"}}),e._v(" "),l("el-table-column",{attrs:{prop:"itemWidth",label:"宽"}}),e._v(" "),l("el-table-column",{attrs:{prop:"itemHeight",label:"高"}}),e._v(" "),l("el-table-column",{attrs:{label:"优先级"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\r\n            "+e._s(t.$index+1)+"\r\n        ")]}}])}),e._v(" "),l("el-table-column",{attrs:{label:"重复次数"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("div",[l("el-input",{attrs:{placeholder:"请输入内容"},model:{value:t.row.repeatTimes,callback:function(l){e.$set(t.row,"repeatTimes",l)},expression:"scope.row.repeatTimes"}})],1)]}}])}),e._v(" "),l("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"将节目下移一行",placement:"top"}},[l("el-button",{attrs:{type:"primary",icon:"el-icon-caret-bottom",circle:""},on:{click:function(l){return e.moveItem(t.$index)}}})],1),e._v(" "),l("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"删除此节目",placement:"top"}},[l("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(l){return e.removeItem(t.$index)}}})],1),e._v(" "),l("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"计划任务",placement:"top"}},[l("el-button",{attrs:{icon:"el-icon-time",circle:""},on:{click:function(l){return e.scheduleManager(t.$index)}}})],1)]}}])})],1),e._v(" "),l("el-dialog",{staticClass:"dialog-common-sys",attrs:{title:"节目清单",visible:e.showProgramDialog,"modal-append-to-body":!1,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showProgramDialog=t},close:function(t){return e.cancelUpdate()}}},[l("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.programList,"tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange}},[l("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),l("el-table-column",{attrs:{prop:"itemName",label:"节目名称"}}),e._v(" "),l("el-table-column",{attrs:{prop:"fileSize",label:"大小"}}),e._v(" "),l("el-table-column",{attrs:{prop:"itemWidth",label:"宽"}}),e._v(" "),l("el-table-column",{attrs:{prop:"itemHeight",label:"高"}})],1),e._v(" "),l("div",{staticStyle:{"text-align":"center","margin-top":"30px"}},[l("el-pagination",{attrs:{background:"","page-size":e.pageSize,layout:"prev, pager, next",total:e.total},on:{"current-change":e.current_change}})],1),e._v(" "),l("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[l("el-button",{on:{click:function(t){e.showProgramDialog=!1}}},[e._v("取 消")]),e._v(" "),l("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addPrograms()}}},[e._v("确 定")])],1)],1),e._v(" "),l("el-dialog",{staticClass:"dialog-common-sys",attrs:{width:"60%",title:"计划任务(计划之间为逻辑与的关系)",visible:e.showScheduleDialog,"modal-append-to-body":!1,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showScheduleDialog=t},close:function(t){return e.cancelUpdate()}}},[l("el-row",[l("el-col",{attrs:{span:12}},[l("el-row",[e._v("日期范围")]),e._v(" "),l("el-row",[l("el-radio",{attrs:{label:"All"},model:{value:e.schedule.dateType,callback:function(t){e.$set(e.schedule,"dateType",t)},expression:"schedule.dateType"}},[e._v("永久")]),e._v(" "),l("el-radio",{attrs:{label:"Range"},model:{value:e.schedule.dateType,callback:function(t){e.$set(e.schedule,"dateType",t)},expression:"schedule.dateType"}},[e._v("自定义")])],1),e._v(" "),"Range"===e.schedule.dateType?l("el-row",[l("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"yyyy 年 MM 月 dd 日","value-format":"yyyy-MM-dd"},on:{change:e.selectDate},model:{value:e.date,callback:function(t){e.date=t},expression:"date"}})],1):e._e(),e._v(" "),l("el-row",[e._v("时间范围")]),e._v(" "),l("el-row",[l("el-radio",{attrs:{label:"All"},model:{value:e.schedule.timeType,callback:function(t){e.$set(e.schedule,"timeType",t)},expression:"schedule.timeType"}},[e._v("永久")]),e._v(" "),l("el-radio",{attrs:{label:"Range"},model:{value:e.schedule.timeType,callback:function(t){e.$set(e.schedule,"timeType",t)},expression:"schedule.timeType"}},[e._v("自定义")])],1),e._v(" "),"Range"===e.schedule.timeType?l("el-row",[l("el-time-select",{attrs:{placeholder:"起始时间","picker-options":{start:"00:00",step:"00:15",end:"24:00",maxTime:e.schedule.endTime}},model:{value:e.schedule.startTime,callback:function(t){e.$set(e.schedule,"startTime",t)},expression:"schedule.startTime"}}),e._v(" "),l("el-time-select",{attrs:{placeholder:"结束时间","picker-options":{start:"00:00",step:"00:15",end:"24:00",minTime:e.schedule.startTime}},model:{value:e.schedule.endTime,callback:function(t){e.$set(e.schedule,"endTime",t)},expression:"schedule.endTime"}})],1):e._e(),e._v(" "),l("el-row",[e._v("指定星期")]),e._v(" "),l("el-row",[l("el-radio",{attrs:{label:"None"},model:{value:e.schedule.filterType,callback:function(t){e.$set(e.schedule,"filterType",t)},expression:"schedule.filterType"}},[e._v("永久")]),e._v(" "),l("el-radio",{attrs:{label:"Week"},model:{value:e.schedule.filterType,callback:function(t){e.$set(e.schedule,"filterType",t)},expression:"schedule.filterType"}},[e._v("自定义")])],1),e._v(" "),"Week"===e.schedule.filterType?l("el-row",[l("el-checkbox-group",{model:{value:e.schedule.weekFilter,callback:function(t){e.$set(e.schedule,"weekFilter",t)},expression:"schedule.weekFilter"}},[l("el-checkbox",{attrs:{label:"1"}},[e._v("星期一")]),e._v(" "),l("el-checkbox",{attrs:{label:"2"}},[e._v("星期二")]),e._v(" "),l("el-checkbox",{attrs:{label:"3"}},[e._v("星期三")]),e._v(" "),l("el-checkbox",{attrs:{label:"4"}},[e._v("星期四")]),e._v(" "),l("el-checkbox",{attrs:{label:"5"}},[e._v("星期五")]),e._v(" "),l("el-checkbox",{attrs:{label:"6"}},[e._v("星期六")]),e._v(" "),l("el-checkbox",{attrs:{label:"7"}},[e._v("星期天")])],1)],1):e._e(),e._v(" "),l("div",{staticStyle:{"padding-top":"40px"}},[l("el-button",{attrs:{type:"primary"},on:{click:e.addOneSchedule}},[e._v("新增一条时间计划")])],1)],1),e._v(" "),l("el-col",{attrs:{span:12}},[l("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.scheduleList,"tooltip-effect":"dark"}},[l("el-table-column",{attrs:{formatter:e.dateRangeFmt,label:"日期范围"}}),e._v(" "),l("el-table-column",{attrs:{formatter:e.timeRangeFmt,label:"时间范围"}}),e._v(" "),l("el-table-column",{attrs:{formatter:e.weekFilterFmt,label:"指定星期"}},[void 0],2),e._v(" "),l("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(l){return e.removeOneSchedule(t.$index)}}})]}}])})],1)],1)],1),e._v(" "),l("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[l("el-button",{on:{click:function(t){return e.cancelUpdate()}}},[e._v("取 消")]),e._v(" "),l("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.saveOrUpdateSchedule()}}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]},d=l("VU/8")(c,r,!1,null,null,null);t.default=d.exports}});