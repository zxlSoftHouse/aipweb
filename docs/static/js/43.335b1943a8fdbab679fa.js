webpackJsonp([43],{Ir3c:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=o("X4US"),s={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-row",{staticClass:"app-container"},[o("el-col",{staticClass:"container"},[o("div",{staticClass:"heading"},[e.hasPerms("role-xz001")?o("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-plus"},on:{click:e.doAdd}},[e._v("新增")]):e._e()],1),e._v(" "),o("el-table",{ref:"singleTable",staticStyle:{width:"100%"},attrs:{data:e.tableList,border:"","tooltip-effect":"dark","highlight-current-row":""}},[e._e(),e._v(" "),o("el-table-column",{attrs:{property:"roleName",label:"角色名称","show-overflow-tooltip":""}}),e._v(" "),o("el-table-column",{attrs:{label:"操作","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e.hasPerms("role-sc001")?o("el-button",{attrs:{type:"text"},on:{click:function(o){return e.doDelete(t.row.rowId)}}},[e._v("删除")]):e._e(),e._v(" "),e.hasPerms("role-xg001")?o("el-button",{attrs:{type:"text"},on:{click:function(o){return e.doModify(t.row)}}},[e._v("修改")]):e._e(),e._v(" "),o("el-button",{attrs:{type:"text"},on:{click:function(o){return e.treeRow(t.row.rowId)}}},[e._v("分配菜单")]),e._v(" "),o("el-button",{attrs:{type:"text"},on:{click:function(o){return e.manRow(t.row.rowId)}}},[e._v("分配用户")])]}}])})],1),e._v(" "),o("el-dialog",{attrs:{width:"30%","modal-append-to-body":!1,title:e.dialogTitle,visible:e.showDialog,"before-close":e.cannelChange},on:{"update:visible":function(t){e.showDialog=t}}},[o("el-form",{ref:"ruleForm",attrs:{model:e.role,rules:e.rules}},[o("el-form-item",{attrs:{label:"角色代码","label-width":e.formLabelWidth,prop:"roleCode"}},[o("el-input",{attrs:{"auto-complete":"off"},model:{value:e.role.roleCode,callback:function(t){e.$set(e.role,"roleCode",t)},expression:"role.roleCode"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"角色名称","label-width":e.formLabelWidth,prop:"roleName"}},[o("el-input",{attrs:{"auto-complete":"off"},model:{value:e.role.roleName,callback:function(t){e.$set(e.role,"roleName",t)},expression:"role.roleName"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"角色类型","label-width":e.formLabelWidth,prop:"roleType"}},[o("dictionary",{ref:"roleType",attrs:{indexCode:e.roleType,type:e.role.roleType},on:{"update:type":function(t){return e.$set(e.role,"roleType",t)},changeSelDataVal:e.roleTypeChange}})],1)],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{size:"medium"},on:{click:e.cannelChange}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary",size:"medium"},on:{click:function(t){return e.saveOrUpdate(e.role,"ruleForm")}}},[e._v("保 存")])],1)],1),e._v(" "),o("el-dialog",{attrs:{title:"菜单",width:"40%","modal-append-to-body":!1,visible:e.showTreeDialog},on:{"update:visible":function(t){e.showTreeDialog=t}}},[o("el-tree",{ref:"menuTree",attrs:{"default-expanded-keys":e.menuIds,"default-checked-keys":e.menuIds,data:e.treeData,"show-checkbox":"",props:e.treeProps,"node-key":"rowId"}}),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{size:"medium"},on:{click:e.cannelPostTree}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary",size:"medium"},on:{click:e.postTree}},[e._v("保 存")])],1)],1),e._v(" "),o("el-dialog",{staticClass:"role-dialog",attrs:{title:"分配用户","modal-append-to-body":!1,visible:e.showManDialog},on:{"update:visible":function(t){e.showManDialog=t}}},[o("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.userList,border:"","tooltip-effect":"dark","highlight-current-row":""},on:{"selection-change":e.handleSelUserChange}},[o("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),o("el-table-column",{attrs:{property:"userName",label:"用户名"}})],1),e._v(" "),o("div",{staticClass:"pagination-wrapper"},[o("el-pagination",{attrs:{"current-page":e.pageAt,"page-size":e.pageSize,layout:"total, prev, pager, next, jumper",total:e.recordCount},on:{"current-change":e.pagePost}})],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{size:"medium"},on:{click:e.cannelPostMan}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary",size:"medium"},on:{click:e.postMan}},[e._v("保 存")])],1)],1),e._v(" "),o("el-dialog",{staticClass:"tipDialog",attrs:{"modal-append-to-body":!1,title:"提示",visible:e.tipDialog,size:"tiny"},on:{"update:visible":function(t){e.tipDialog=t}}},[o("span",{staticClass:"el-icon-circle-check"}),e._v(" "),o("span",{staticClass:"tipDialogTxt"},[e._v(e._s(e.tipDialogTxt))]),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{type:"primary",size:"medium"},on:{click:function(t){e.tipDialog=!1}}},[e._v("保 存")])],1)])],1)],1)},staticRenderFns:[]},i=o("VU/8")(l.a,s,!1,null,null,null);t.default=i.exports},X4US:function(e,t,o){"use strict";(function(e){var l=o("lHA8"),s=o.n(l),i=o("c/Tr"),r=o.n(i),a=o("buQg"),n=o("0yOY"),u=o("hbRw"),c=o("kTXO");t.a={data:function(){return{roleType:"ROLETYPE",multipleSelection:[],multipleSelectionAllIds:[],userList:[],searchInput:"",roleCode:"",tableList:[],recordCount:0,pageSize:2,pageAt:1,dialogTitle:"新增",showDialog:!1,tipDialog:!1,tipDialogTxt:"",showTreeDialog:!1,showManDialog:!1,role:{roleCode:"",roleName:"",rowId:""},formLabelWidth:"80px",rules:{roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"}],roleCode:[{required:!0,message:"请输入角色代码",trigger:"blur"}]},treeCount:0,treeData:[],treeProps:{children:"childs",label:"menuName"},assignObj:{roleId:null,menuId:[]},menuIds:[],expandedRowIds:[10],manProps:{key:"rowId",label:"userName"},notSelectRoleIds:[],selectRoleIds:[],roleId:0,smRoleMenu:{roleId:null},filterMethod:function(e,t){return t.userName.indexOf(e)>-1}}},methods:{hasPerms:function(e){return Object(c.a)(e)&!this.disabled},roleTypeChange:function(e){this.role.roleType=e},getList:function(){var e=this;a.a.getRoleList().then(function(t){e.tableList=t},function(t){e.tableList=t.body},!1)},doRefresh:function(){this.pageAt=1,this.getList()},resetForm:function(e){this.$refs[e].resetFields()},doAdd:function(){this.showDialog=!0,this.dialogTitle="新增",this.role={roleCode:"",roleName:""}},doDelete:function(e){var t=this;u.a.deleteRow(e).then(function(e){t.$message({type:"success",message:"删除成功!"}),t.getList()},function(e){t.$message.error("网络异常，无法执行该操作!")},!1)},doModify:function(e){this.dialogTitle="修改",this.showDialog=!0,this.role.rowId=e.rowId,this.role.roleName=e.roleName,this.role.roleCode=e.roleCode},saveOrUpdate:function(e,t){var o=this;delete e.gmtCreate;this.dialogTitle;this.$refs[t].validate(function(e){if(!e)return!1;o.showDialog=!1,u.a.addOrUpdate(o.role).then(function(e){o.$message({type:"success",message:"新增"==o.dialogTitle?"新增成功!":"修改成功!"}),o.getList()},function(e){o.$message.error("网络异常，无法执行该操作!")},!1)})},cannelChange:function(){this.resetForm("ruleForm"),this.showDialog=!1,this.getList()},getMenu:function(e){var t=this;a.a.getMenuAll().then(function(o){t.treeData=o,t.getRoleIdSearchMenu(e)}).catch(function(e){console.log(e)})},getRoleIdSearchMenu:function(e){var t=this;a.a.getMenuQueryRole({roleId:e}).then(function(e){t.menuIds=[],e.map(function(e){t.menuIds.push(e.menuId)}),t.menuIds=r()(new s.a(t.menuIds)),t.$refs.menuTree.setCheckedKeys(t.menuIds)}).catch(function(e){console.log(e)})},treeRow:function(e){var t=this;this.getMenu(e),this.treeCount>0?setTimeout(function(){t.showTreeDialog=!0},100):this.showTreeDialog=!0,this.assignObj.roleId=e,this.treeCount++},postTree:function(){var e=this,t=[this.$refs.menuTree.getCheckedKeys(),this.getIndeterminate()],o=t[0];this.assignObj.menuId=o,u.a.saveMenu(this.assignObj).then(function(t){e.assignObj={roleId:null,menuId:[]},e.$message({type:"success",message:"调整成功!"}),e.showTreeDialog=!1}).catch(function(t){e.$message.error("网络异常，无法执行该操作!")})},cannelPostTree:function(){this.showTreeDialog=!1,this.assignObj={roleId:null,menuId:[]}},getHasSelect:function(){var t=this;e.post(api.smUser,{},{params:{hasSelectRoleId:this.roleId}},function(e){e.body.result&&0!=e.body.result.length&&(t.selectRoleIds=e.body.result.map(function(e){return e.rowId}))},function(e){},!1)},manRow:function(e){var t=this;"changePage"!==e&&(this.pageAt=1,this.roleId=e,this.role.roleId=e),this.selectRoleIds=[],this.showManDialog=!0;var o={pageNum:this.pageAt,pageSize:this.pageSize};n.a.getUserList(o).then(function(o){t.userList=o.records||[],t.recordCount=o.total,"changePage"!==e?u.a.queryByInfo({roleId:t.role.roleId}).then(function(e){t.multipleSelectionAllIds=[],e.map(function(e){t.multipleSelectionAllIds.push(e.userId)}),t.$utils.setSelectRow(t.multipleSelectionAllIds,t.$refs.multipleTable,t.userList)}):setTimeout(function(){t.$utils.setSelectRow(t.multipleSelectionAllIds,t.$refs.multipleTable,t.userList)},200)}).catch(function(e){})},handleSelUserChange:function(e){this.multipleSelection=e},postMan:function(){var e=this;this.multipleSelectionAllIds=this.$utils.changePageCoreRecordData(this.multipleSelectionAllIds,this.multipleSelection,this.userList);var t={roleId:this.role.roleId,userIds:this.multipleSelectionAllIds};u.a.saveUsersByRoleId(t).then(function(t){e.$message({type:"success",message:"调整成功!"}),e.showManDialog=!1}).catch(function(t){e.$message.error("网络异常，无法执行该操作!")})},cannelPostMan:function(){this.showManDialog=!1},pagePost:function(e){this.multipleSelectionAllIds=this.$utils.changePageCoreRecordData(this.multipleSelectionAllIds,this.multipleSelection,this.userList),this.pageAt=e,this.manRow("changePage")},getIndeterminate:function(){var e=this.$refs.menuTree.$el.querySelectorAll(".el-tree-node");return[].map.call(e,function(e){return e.__vue__}).filter(function(e){return!0===e.indeterminate}).map(function(e){return e.$vnode.data.key})}},mounted:function(){this.getList()}}}).call(t,o("DuR2"))}});